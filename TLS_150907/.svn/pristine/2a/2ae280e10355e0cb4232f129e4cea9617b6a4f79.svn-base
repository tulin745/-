//
//  ProductDetailViewController.m
//  TLS
//
//  Created by 屠淋 on 15/8/23.
//  Copyright (c) 2015年 tulin. All rights reserved.
//

#import "ProductDetailViewController.h"
#import "ShareView.h"
#import "SGFocusImageFrame.h"
#import "SGFocusImageItem.h"
#import "ProductNameTableViewCell.h"

@interface ProductDetailViewController ()<UITableViewDataSource,UITableViewDelegate,SGFocusImageFrameDelegate>

@property (weak, nonatomic) IBOutlet UITableView *tableView;
@property (nonatomic, strong) ShareView *shareView;
@property (nonatomic, strong) SGFocusImageFrame *viewImage;

@end

@implementation ProductDetailViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.title = @"Product Details";
    self.navigationItem.rightBarButtonItem = [UIBarButtonItem itemWithIcon:@"share" highlightIcon:@"" target:self action:@selector(shareTo:)];
    
    self.tableView.tableFooterView = [[UIView alloc]init];
    
    NSIndexPath *selectedIndexPath = [NSIndexPath indexPathForRow:0 inSection:0];
    [self.tableView selectRowAtIndexPath:selectedIndexPath animated:NO scrollPosition:UITableViewScrollPositionNone];
    
}


- (void)shareV{
    
    ShareView *shareView = [[ShareView alloc]initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT)];
    [[UIApplication sharedApplication].keyWindow addSubview:shareView];
    self.shareView = shareView;
    
}

#pragma mark - scrollView

- (void)loadPicturewithView:(UIView*)superView andDic:(NSDictionary*)dicData{
    
    NSDictionary *dic= @{@"ResponseData":
                             @[@{@"Title":@"",@"PicUrl":@"http://a4.att.hudong.com/16/27/19300001317260131200271451486_950.jpg"},
                               @{@"Title":@"",@"PicUrl":@"http://www.xaecong.com/uploadfile/2015-4/20150404195911560.jpg"},
                               @{@"Title":@"",@"PicUrl":@"http://a4.att.hudong.com/16/27/19300001317260131200271451486_950.jpg"},
                               @{@"Title":@"",@"PicUrl":@"http://www.xaecong.com/uploadfile/2015-4/20150404195911560.jpg"}]};
    
    NSArray *reArray = [ShufflingInfo paraseShufflingInfoWithData:[dic objectForKey:@"ResponseData"]];
    
    NSMutableArray *tempArray = [NSMutableArray arrayWithCapacity:[reArray count]];
    
    for (int i = 0; i < [reArray count]; i++) {
        SGFocusImageItem *item = [[SGFocusImageItem alloc] initWithShufflingInfo:[reArray objectAtIndex:i]];
        [tempArray addObject:item];
    }
    NSInteger length = [tempArray count];
    NSMutableArray *itemArray = [NSMutableArray arrayWithCapacity:length+2];
    //添加最后一张
    if (length > 1) {
        SGFocusImageItem *lastItem = [tempArray objectAtIndex:length - 1];
        [itemArray addObject:lastItem];
    }
    for (int i = 0; i < length; i++)
    {
        SGFocusImageItem *item = [tempArray objectAtIndex:i];
        [itemArray addObject:item];
    }
    //添加第一张
    if (length >1)
    {
        SGFocusImageItem *item = [tempArray objectAtIndex:0];
        [itemArray addObject:item];
    }
    
    CGFloat height = 0;
    if (SCREEN_WIDTH == 320) {
        height = 200;
    }else if(SCREEN_WIDTH == 375){
        height = 255;
    }else{
        height = 300;
    }
    
    SGFocusImageFrame *view = [[SGFocusImageFrame alloc] initWithFrame:CGRectMake(0, 50, SCREEN_WIDTH, height - 50) delegate:self imageItems:itemArray];
    
    [superView addSubview:view];
    self.viewImage = view;
}


#pragma mark - UITableViewDataSource,UITableViewDelegate

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{
    
    return 1;

}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    
    return 5;

}

- (UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    static NSString *cellIndetifier = @"cell";
    UITableViewCell *cell = [[UITableViewCell alloc]initWithStyle:UITableViewCellStyleDefault reuseIdentifier:cellIndetifier];
    switch (indexPath.row) {
        case 0://Image
        {
            UIView *view = [[UIView alloc]init];
            view.backgroundColor = [UIColor whiteColor];
            cell.selectedBackgroundView = view;
            [cell.contentView addSubview:self.viewImage];
            
        }
            break;
        case 1://productName
        {
            ProductNameTableViewCell *cell = NIB_Load(@"ProductNameTableViewCell");
            cell.nameLabel.text = @"prifdshfkjskfjdksfhsfdshjfhfhuilahfjsayhukflndjsalhfjdsaklfudsalhfdskahfjdksalfhjdks.afndjkslanfdksafjdsk.afnjdklsanfjkdlsafienjilfndmsfajdioncuiofnjkdlsfhjkd;ahi";
            return cell;
        }
            break;
        case 2://availability
        {
            UITableViewCell *cell = [[UITableViewCell alloc]initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:@"cell"];
            cell.textLabel.text = @"Availability (May Vary)";
            cell.textLabel.font = [UIFont systemFontOfSize:14];
            cell.detailTextLabel.text = @"In stok";
            cell.detailTextLabel.font = [UIFont systemFontOfSize:14];
            cell.detailTextLabel.textColor = UIColorFromRGB(0x65c607);
            return cell;
        }
            break;
        case 3://QUICK OVERVIEW
        {
            
        }
            break;
        case 4://details specification downloads
        {
            
        }
            break;
            
        default:
            break;
    }
    return cell;
}


- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    if (indexPath.row == 0 ) {
        return 250;
    }else if (indexPath.row == 1){
        return 80;
    }else if (indexPath.row == 2){
        return 40;
    }else if (indexPath.row == 3){
        return 50;
    }else if (indexPath.row == 4){
        return 150;
    }
    return 0;
}


- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (void)shareTo:(UIButton*)btn{
    
    [self.shareView showShareView];

}


#pragma mark - SGFocusImageFrameDelegate

- (void)foucusImageFrame:(SGFocusImageFrame *)imageFrame didSelectItem:(SGFocusImageItem *)item{
    
    
}


- (void)foucusImageFrame:(SGFocusImageFrame *)imageFrame currentItem:(int)index{
    
    
    
}

@end
